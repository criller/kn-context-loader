# BKN Agent 探索与精确双模检索架构
您的要求是基于业务知识网络（BKN）的现有架构，并借鉴 Morph SDK 的核心设计思想（即语义搜索和精确匹配的结合），设计一套用于 DataAgent 获取相关上下文信息的检索工具。
我们将暂时不参考当前统一检索模块的具体设计，而是专注于构建两个高度专业化、且能完美契合 BKN 本体架构的工具，以实现 Morph 所推崇的“探索（Discovery）”和“精确（Precision）”的最佳结合。
Morph 设计思想在 BKN 架构中的映射
Morph 证明了最高准确率需要结合两种搜索模式。在 BKN 这种由本体模型、多模态数据和逻辑/行动资源构成的复杂网络中，这种结合尤为重要。
Morph 检索模式
BKN 知识网络中对应能力
核心应用场景 (Agent 的需求)
语义搜索 (Semantic Search)
概念查询/向量检索/意图识别
探索 (Discovery)：处理 Agent 的高阶意图和概念性问题，例如：“我们在哪里定义了供应商的审核流程？”。
Grep (精确匹配)
本体查询/结构化查询/全文检索
精确性 (Precision)：当 Agent 知道 要查找具体的实体、属性值或文档中的精确段落时使用，例如：“查询所有月消费超 5000 元的女性客户群体”或查找某协议的精确定义。
为了 DataAgent 能高效地获取上下文，需要设计两个核心工具，由 Agent 使用 Dolphin Language Runtime 进行编排和调用。
--------------------------------------------------------------------------------
工具设计方案：DataAgent 的双检索工具集
我们将设计两个独立的、但功能互补的工具：知识发现工具（Knowledge Discovery Tool） 和 本体精确定位工具（Ontology Pinpoint Tool）。
工具一：知识发现工具（Knowledge_Discovery_Tool）
该工具对应 Morph 的语义搜索功能，专注于根据 Agent 的自然语言意图，快速从大规模 BKN 中召回概念性和语义相关的知识上下文，实现“缩小范围”的目标。
核心能力与 BKN 底层技术调用：
1. 语义理解与意图映射：
    ◦ Agent 输入： 自然语言查询（如：“如何处理客户退款争议？”）。
    ◦ 处理逻辑： 通过意图识别模块（通常依赖 LLM），将查询映射到 BKN 的概念（对象类、关系类、行动类）。
2. 多模态召回引擎：
    ◦ 非结构化召回： 调用多模态数据湖 的向量数据库（OpenSearch） 和 全文检索库（OpenSearch）。用于检索非结构化文档（如方案设计、报告）中的语义相关片段。
    ◦ 结构化/关系召回： 利用图数据库（Nebula） 进行图检索，查找与查询概念在 BKN 本体模式层 上关联最紧密的实体和关系子图，确保提供结构化背景。
3. 高质量上下文提炼（借鉴 Morph 优化）：
    ◦ 定制嵌入与分块： 依赖 BKN 建设阶段从文档中抽取出的结构化知识和知识图谱嵌入（KG Embedding），这相当于 Morph 中针对代码定制的“自定义代码嵌入模型”和“AST 感知分块”。
    ◦ 智能重排 (ReRank)： 对多模态召回的候选结果进行 ReRank 模型服务 评分，该模型应基于真实的 Agent 任务追踪进行训练，以优化任务完成度所需要的相关性，而不是通用相似度。
4. 工具输出：
    ◦ 一个包含得分最高的知识片段、实体 ID 或文档 URI 的列表。这些片段作为 Agent 进行下一步精确查询的上下文基座。
工具二：本体精确定位工具（Ontology_Pinpoint_Tool）
该工具对应 Morph 的 grep 功能，专注于在 Agent 拥有清晰目标后，提供原子化、精确且低延迟的查询能力，实现“精确定位”的目标。
核心能力与 BKN 底层技术调用：
1. 精确本体查询（Structured Query）：
    ◦ Agent 输入： 结构化的查询参数（例如：对象类名称、属性名称、精确的过滤条件）。
    ◦ 对象&属性查询： 允许 Agent 精确检索对象类的实例和其数据属性（静态特征）及逻辑属性（动态特征）的值。
    ◦ 关系查询： 支持 Agent 查询实体间的关系，例如通过路径长度、关系方向和过滤条件，检索目标子图。
2. 精确文本定位（Full-Text Grep）：
    ◦ Agent 输入： 目标文档 ID 或范围，以及精确的关键词或模式（如：SLA_等级 >= 99.9%）。
    ◦ 查询机制： 对指定文档执行全文检索（OpenSearch），返回关键词出现的精确位置或包含该关键词的最小知识单元。
3. 虚拟化查询加速（借鉴 Morph 性能优化）：
    ◦ 零复制查询： 许多精确数据（如客户年龄、实时健康度）是高性能资源。该工具不直接存储这些数据，而是通过 VEGA 虚拟化引擎 将查询（如 SQL/DSL）下推到源系统去执行，然后将结果实时整合返回。这确保了 DataAgent 获取数据的时效性和精确性。
4. 工具输出：
    ◦ 结构化的数据表、JSON 格式的实体记录、计算出的属性值或包含精确关键词的文档引用位置。
3. DataAgent 的工具使用工作流（Morph 模式）
DataAgent 使用 Dolphin-Lang 进行流程配置，以实现 Morph 倡导的先探索、后定位的模式。
1. Agent 接收高阶任务： DataAgent 接收用户查询，例如：“哪些客户符合我们的‘流失预警’标准，并且最近 24 小时内有负面评价？”
2. 调用 Tool 1 (知识发现)： Agent 首先调用 Knowledge_Discovery_Tool 获取上下文。
    ◦ 发现： 语义搜索召回：“客户流失风险”的逻辑属性定义、“流失预警”的行动类、“负面评价”的概念、以及相应的本体模型说明书。
3. 分析上下文并规划精确查询： Agent 基于 Tool 1 返回的上下文（例如，知道“流失预警”的逻辑属性名称是 churn_risk_score，阈值是 > 80），制定精确查询计划。
4. 调用 Tool 2 (本体精确定位)： Agent 调用 Ontology_Pinpoint_Tool 执行精确、结构化的查询：
    ◦ 精确查询 1（属性查询）： Attribute_Query(Object='客户', Attribute='churn_risk_score', Filter='Value > 80')。
    ◦ 精确查询 2（全文/向量检索）： 结合时间条件，查询在非结构化文档（如客服工单、舆情数据）中带有负面评价标签 且关联到这些高风险客户。
5. 结果融合： Agent 将 Tool 2 返回的精确客户列表和负面评价记录进行融合，生成最终的可信赖、可操作的决策结果，并将其作为上下文 交付给 LLM 进行自然语言回答。
这种设计确保了 Agent 在面临复杂业务知识网络时，能够避免在海量信息中盲目搜索，而是能够以结构化的、高效的两步法获取上下文，从而将 DataAgent 的准确率和响应速度最大化。