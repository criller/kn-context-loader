# 基础能力说明（文本版）

目标
- 以“业务知识网络”的视角，纯文本列出需要具备的基础能力，不涉及接口或实现细节，便于后续方案设计对齐。

M1（原型阶段，必须具备）
- 实例检索（Entity Lookup）
  - 依据名称/别名/类型/属性筛选实体；支持模糊匹配与同义词；支持limit/分页与排序（相关性/时间等）。
- 子图查询（Neighborhood / Expand）
  - 以种子实体为中心，按关系类型、方向与深度扩展邻域；支持对对象（节点）属性过滤；暂不支持边属性过滤；支持结果规模限制与守护（max_nodes/max_edges）。
- 关系确认（一跳）
  - 判断两个实体间是否存在指定的一跳关系；可返回相邻边与节点；支持方向与关系类型限定。
- 属性获取（对象）
  - 读取实体的属性值；支持别名归一与缺失值处理；可指定条件（如最新值、状态筛选）。
- 澄清（Clarify）
  - 当歧义/低置信/能力缺失/参数异常时，输出澄清问题与建议过滤项，帮助收敛为可执行请求。
- 混合模式（Hybrid）
  - 在自然语言中嵌入结构化限定（类型、关系、属性、时间范围），提升可控性。

M2（增强阶段，按需规划）
- 路径查询（Path）
  - 在多跳范围内查找从源到目的的路径；可约束关系类型、方向与最大深度；支持最短路径或全部匹配路径（受限）。
- 聚合与统计（Aggregate）
  - 基于对象与关系结果进行计数、分组与Top-K排序（例如“拥有专利最多的企业前10”）。
- 集合运算与比对（Set / Compare）
  - 邻居交集/并集/差集、相似度对比。
- 文本检索/RAG（Texts）
  - 检索与实体相关的文本（摘要、说明等），用于问答或辅助说明。

输出期望（文本描述）
- 实例检索：返回实体的基础属性（如名称、类型、关键字段）；
- 子图查询/关系确认：返回本地子图（节点与边）或一跳关系的节点/边清单；
- 属性获取：返回指定属性字段的值；
- 路径/聚合（M2）：返回路径集合或统计结果（含分组与计数）。

方向策略（统一）
- 术语定义
  - 正向：按TBox中关系的定义方向使用（source → target）
  - 反向：按关系的逆向使用（target ← source）
  - 双向：同时取正向与反向，用于“全邻居/闭合子图”等需求
- 表达格式（在“用户故事”的“TBox关系路径说明”中统一）
  - 示例：enterprise → park（enterprise_2_park，正向，一跳）
  - 示例：park ← enterprise（enterprise_2_park，反向，一跳）
  - 多跳路径示例：enterprise → material → reaction（默认各跳为正向）；可混合方向示例：material → reaction ← process（第三跳为反向）
- 默认策略（方案A）
  - 一跳关系确认与路径查询默认采用正向；如用户未明确方向，进入澄清Clarify
  - 子图查询默认采用双向；可手动指定仅正向或仅反向
  - 聚合/集合运算/文本检索RAG等场景需在集合构造或回溯时明确方向，未指明则进入澄清Clarify
- Clarify方向澄清模板（文本提示）
  - 您希望采用“正向/反向/双向”的哪一种？
  - 若为路径查询，请为每一跳指定方向或采用默认正向
  - 若为子图查询，请选择方向策略（仅正向/仅反向/双向）以及最大跳数
- 验收要点（方向相关）
  - 用户故事的“TBox关系路径说明”需显式标注方向与跳数
  - 在统计与集合运算中，按所选方向构造集合，计数与运算基于该集合
  - 当方向未指明时，必须输出澄清提示（不静默默认）

关系连接与基数（Join & Cardinality）
- 术语与字段
  - join_strategy：关系连接策略，枚举值 by_id | field_equality | external_edge
  - source_join_fields / target_join_fields：连接字段列表，如 ["id"] 或 ["name","number"]
  - cardinality：关系基数/多重性，one_to_one | one_to_many | many_to_one | many_to_many
- 默认与规范
  - 默认采用 join_strategy=by_id，source_join_fields=["id"]，target_join_fields=["id"]
  - TBox 中每个关系类型需给出上述 3 类字段；示例已在 kn_tbox.json 与 kn_tbox_example.json 中体现
- 影响与处理
  - 基数影响集合构造与计数：多对多关系可能产生重复，应在聚合/集合运算中约定去重规则
  - 当需要按业务键连接（如 name/number），请显式指定 field_equality 及对应字段
- Clarify（连接相关）
  - 您希望用哪个字段作为连接键？可选：id / 业务键（name/number 等）
  - 若存在一对多/多对多，是否需要去重或限制数量？未明确将给出澄清提示
- 验收要点（连接相关）
  - TBox 关系类型定义包含 join_strategy、source_join_fields、target_join_fields、cardinality
  - 示例文件 kn_tbox.json 与 kn_tbox_example.json 可被 JSON 校验通过（结构合法）

注意事项
- 支持别名与术语归一，减少同名/近义词干扰；
- 对规模进行守护（limit/depth），避免过大结果；
- 需要透明的澄清过程（问题与建议项），但本文件不涉及实现方案。