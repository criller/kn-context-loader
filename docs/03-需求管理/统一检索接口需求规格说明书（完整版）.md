# 统一检索项目需求说明

本说明严格依据《01-需求管理/需求说明模板.md》编写，聚焦“需求”本身：背景、目标、用户故事与验收，不展开接口字段或实现细节；涉及输入/输出仅给出原则与占位，待方案评审后补充。

## 1. 背景与目标
- 背景：
  - 业务知识网络已具备多类查询能力（实例检索、子图、实体搜索等），但入口分散、口径不一，AI/Data Agent 难以稳定复用。
  - 现状痛点：同一问题需要多接口拼装；方向/深度/去重等口径不统一；歧义场景缺少澄清，易误检索或结果爆炸。
  - 业务机会：为分析师与 Agent 提供“统一、透明、可澄清”的检索体验，降低沟通成本与试错成本，提高召回质量与可解释性。

## 2. 用户故事 / 场景（M1）
- 场景 1：企业名称检索
  - 用户表达：查找名称包含“化工”的企业
  - 期望体验：能返回企业列表与基础信息（名称、地址等）；同名较多时提示进一步限定（对象类型、地域等）
  - 验收要点：结果相关、可控且可解释（展示默认排序规则与限制）
- 场景 2：企业的一跳关联浏览
  - 用户表达：企业A在哪个园区、有哪些专利、生产哪些物料？
  - 期望体验：以企业为起点，浏览其直接关联的园区/专利/物料；能控制展开深度与规模
  - 验收要点：一跳邻域清晰可读；能说明方向/深度/限制的默认与选择
- 场景 3：一跳关系确认
  - 用户表达：企业A是否坐落在园区B？是否拥有专利P001？
  - 期望体验：给出存在/不存在的明确结论，并展示相邻的对象与关系说明
  - 验收要点：结论明确、理由可解释；当信息不足时提供澄清提示
- 场景 4：属性获取（对象属性）
  - 用户表达：企业A的注册地址是什么？专利 CN1234567 的当前状态与授权日期？
  - 期望体验：直接返回目标对象的属性值；当字段缺失或别名不一致时提示并归一
  - 验收要点：字段口径一致、缺失可解释、别名归一
- 场景 5：澄清（Clarify）
  - 用户表达：模糊或歧义问题，如“华化”的公司是哪家？“企业→园区”的方向未说明
  - 期望体验：系统提出澄清问题与候选（对象类型/方向/深度/去重口径/连接键等），引导收敛到可执行范围
  - 验收要点：澄清触发合理、话术清晰、候选可信且可选择；澄清后的范围可解释
- 场景 6：混合模式（NL+限定）
  - 用户表达：查找企业A在2021年后授权、IPC包含 C07D 的专利，并返回摘要
  - 期望体验：识别对象与限定（时间/状态/分类），控制返回数量；术语别名自动归一
  - 验收要点：限定识别准确、结果规模受控、别名处理合理、透明可解释

（M2 规划：路径查询、聚合统计、集合运算与比对、文本检索 RAG；本需求为范围外，仅保留里程碑与验收口径占位）

## 3. 输入 / 输出（原则与占位）
- 原则：
  - 统一封装一次性表达意图与选项；响应需包含可解释信息（计划、说明、指标）以便复核。
  - 支持 dry-run（仅解释与计划，不执行）与执行两种模式，用于调试与控制风险。
  - 澄清应返回问题、候选与建议项，便于用户或 Agent 选择。
- 占位说明：
  - 具体字段与结构不在本需求先行定义；待“统一检索方案/接口设计评审”通过后补充到附录。

## 4. 约束与边界
- 技术约束（原则）：
  - 需对深度/规模/limit 设置守护与降级策略，并在说明中透明记录。
  - 澄清触发由置信度与缺参等条件驱动；默认策略（方向/深度/去重）不应静默应用，需在交互中提示。
- 业务边界（M1）：
  - 对象域范围（M1）：企业/园区/专利/物料；典型关系：入驻/拥有/生产。
  - 先覆盖上述核心对象与关系；其他对象（如人员/客户）暂不纳入原型。
  - 路径/聚合/集合/RAG 等增强能力暂不纳入 M1 的必备范围。
- 安全与鉴权:
  - 明确数据可见性与日志留痕；支持最小化访问与审计；不在本需求展开接口级细节。
- Clarify 触发原则（v1）：
  - 概念/对象类型低置信：意图或概念识别 top1 置信度 < 0.60，或 top1-top2 < 0.15 → 询问对象类型；
  - 实体歧义：实体链接 top1 置信度 < 0.70，或 top2 与 top1 差距 < 0.15 → 提供候选实体列表（名称/地址/ID）；
  - 关系方向未指明：表达涉及关系但未指明方向，且存在双向可能 → 询问方向（source→target 或 target→source）；
  - 深度/规模不确定或可能超限：预测结果规模 > 预设 limit（如 >200 项）或 depth > 1 → 询问是否限制深度/增加过滤/设置 limit；
  - 过滤缺失且集合过大：缺少时间/状态/分类等关键过滤，且集合基数预计较大 → 建议添加过滤（示例选项）；
  - 能力不支持或超出 M1：识别为路径/聚合/集合/RAG 等 M2 能力 → 说明不支持并建议降级或延后；
  - 接口/限额冲突：depth/limit 超出 capabilities 限额 → 自动降级并提示；若降级影响结果语义 → 询问是否继续；
  - 话术模板（示例）：
    - “我理解你要查询{对象/关系}，但存在{歧义/缺参/规模风险}。请从以下选项中确认：{对象类型候选/方向/深度/时间/状态/limit}。”
    - “为避免结果过大，建议设置 limit 与过滤条件（如时间/状态）。是否按建议执行？”

## 5. 非功能需求（NFR）
- 性能（暂沿用示例值，后续评审可调整）：dry-run 95% ≤ 200ms；执行 95% ≤ 800ms（典型结果≤100节点）；
- 可用性/容错：统一错误结构（错误码/信息/步骤/建议）；支持自动降级（降深度/降数量）；
- 可扩展性：模块化（澄清/解释/规则与别名）；新增能力按注册即可接入；
- 透明与可解释：每次交互均可说明“怎么理解/为什么这样做/限制是什么”。

## 6. 成功标准 / 验收准则
- 用例列表（通过即验收）：
  1) 实例检索：名称含“化工”的企业 → 返回列表与基础信息；
  2) 子图：企业A的一跳邻域（园区/专利/物料） → 返回清晰的关联视图；
  3) 关系：企业A是否入驻园区B / 是否拥有专利P001 → 明确结论与说明；
  4) 属性：企业地址 / 专利状态与授权日期 → 字段归一且结果可解释；
  5) Clarify：同名企业/方向未指明 → 返回澄清问题与候选列表；
  6) Hybrid：企业A在2021年后授权且 IPC 含 C07D 的专利 → 返回受控结果与摘要；
  7) Dry-run：上述请求在 dry-run=true 时仅返回计划/解释/意图与置信度。
- 指标（暂定）：dry-run 95% ≤ 200ms；执行 95% ≤ 800ms（结果≤100节点）；错误率≤1%；澄清触发比例≤15%；规模守护有效（无爆炸）。

## 7. 里程碑与优先级
- M1（原型，P0）：
  - 完成需求对齐与澄清模板；
  - 跑通六类场景的完整交互（含 dry-run 与解释、澄清触发）；
  - 打通最小实现（不要求接口字段定稿），重点验证透明性与澄清有效性。
- M2（扩展，P1）：
  - 增强路径/聚合/集合/RAG 能力；
  - 引入排序与打分（bm25/embedding 混排）；
  - 完善鉴权与多租户策略。

## 8. 相关文档与链接
- 模板与示例：
  - 《01-需求管理/需求说明模板.md》
  - 《01-需求管理/需求示例-统一检索接口（原型）.md》
- 场景分析：
  - 《03-场景分析/0、场景分析总览.md》《1、基础能力说明.md》《场景用例表.md》及各场景文档
- 方案与解释（参考用，不在本需求展开字段）：
  - 《统一检索-Query Planner（NL模式）设计.md》《统一检索-Query Planner（NL模式）解释说明.md》

## 9. 待办清单（TODO）
- [ ] 评审并冻结 M1 场景的用户表达与验收要点（按本说明列项逐条确认）
- [ ] 补充澄清话术模板与触发阈值（概念/实体/关系/方向/深度/去重/连接键）
- [ ] 在方案评审后补充“输入/输出字段附录”（不影响需求本体）
- [ ] 制定规模守护与自动降级的规则清单（透明记录与提示）