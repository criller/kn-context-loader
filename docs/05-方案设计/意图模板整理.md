# 意图模板示例详解

## 文档目的

通过具体的化工领域示例，详细讲解知识图谱查询的意图模板设计，让开发者能够清晰理解每种查询场景的模板结构和使用方法。

## 背景说明

### TBox概览（化工领域）
我们的知识图谱包含以下主要实体类型：
- **企业**（enterprise）：化工企业，有名称、地址、简介等属性
- **园区**（park）：工业园区，有名称、地址等属性  
- **专利**（patent）：专利信息，有专利号、标题、状态等属性
- **物质物料**（material）：化学物质，有名称、CAS号、化学式等属性
- **化学反应**（reaction）：化学反应，有反应名称、方程式、条件等属性
- **工艺**（process）：生产工艺，有工艺名称、流程、设备等属性

### 主要关系类型
- `enterprise_2_park`：企业坐落在园区
- `enterprise_2_patent`：企业拥有专利
- `enterprise_2_material`：企业生产物料
- `material_2_reaction`：物料参与反应
- `reaction_2_material`：反应产生物料
- `material_2_process`：物料参与工艺消耗

## 统一意图模板结构

```json
{
  "action": "查询动作类型",
  "targets": [
    {
      "type": "实体类型",
      "filters": {"属性过滤条件"},
      "attributes": ["指定返回的属性字段（可选）"]
    }
  ],
  "relations": [
    {"type": "关系类型", "direction": "方向"}
  ],
  "depth": "查询深度",
  "limit": "结果数量限制"
}
```

## 查询场景分类与模板详解

### 一、实例检索类（Retrieve）
> **场景特点**：查询特定类型的实体实例，不涉及关系扩展
> **核心动作**：`action: "retrieve"`

#### 1.1 全量检索
**用户需求**："有哪些化工企业？"

**意图模板**：
```json
{
  "action": "retrieve",
  "targets": [{
    "type": "enterprise",
    "filters": {
      "*": {"op": "match", "value": "化工"}
    }
  }]
}
```

**期望输出**：
```json
{
  "results": [
    {"id": "ent_001", "name": "万华化学", "address": "山东烟台", "type": "enterprise"},
    {"id": "ent_002", "name": "中石化", "address": "北京", "type": "enterprise"},
    {"id": "ent_003", "name": "巴斯夫", "address": "上海", "type": "enterprise"}
  ],
  "total": 156,
  "query_type": "retrieve"
}
```

#### 1.2 精确匹配检索
**用户需求**："万华化学的基本信息"

**意图模板**：
```json
{
  "action": "retrieve",
  "targets": [{
    "type": "enterprise",
    "filters": {
      "name": {"op": "match", "value": "万华化学"}
    }
  }]
}
```

**期望输出**：
```json
{
  "results": [
    {
      "id": "ent_001",
      "name": "万华化学",
      "address": "山东烟台",
      "brief_info": "全球领先的化工新材料公司",
      "type": "enterprise"
    }
  ],
  "total": 1,
  "query_type": "retrieve"
}
```

#### 1.3 属性过滤检索
**用户需求**："山东的化工企业有哪些？"

**意图模板**：
```json
{
  "action": "retrieve",
  "targets": [{
    "type": "enterprise",
    "filters": {
      "address": {"op": "contains", "value": "山东"}
    }
  }]
}
```

**期望输出**：
```json
{
  "results": [
    {"id": "ent_001", "name": "万华化学", "address": "山东烟台", "type": "enterprise"},
    {"id": "ent_004", "name": "东明石化", "address": "山东菏泽", "type": "enterprise"}
  ],
  "total": 2,
  "query_type": "retrieve"
}
```

#### 1.4 特殊标识符检索
**用户需求**："CAS号64-17-5是什么物料？"

**意图模板**：
```json
{
  "action": "retrieve",
  "targets": [{
    "type": "material",
    "filters": {
      "cas_no": {"op": "eq", "value": "64-17-5"}
    }
  }]
}
```

**期望输出**：
```json
{
  "results": [
    {
      "id": "mat_001",
      "name": "乙醇",
      "cas_no": "64-17-5",
      "formula": "C2H6O",
      "type": "material"
    }
  ],
  "total": 1,
  "query_type": "retrieve"
}
```

#### 1.5 指定属性检索
**用户需求**："万华化学的注册地址和成立时间是什么？"

**意图模板**：
```json
{
  "action": "retrieve",
  "targets": [{
    "type": "enterprise",
    "filters": {
      "name": {"op": "match", "value": "万华化学"}
    },
    "attributes": ["name", "address", "registration_date"]
  }]
}
```

**期望输出**：
```json
{
  "results": [
    {
      "id": "ent_001",
      "name": "万华化学",
      "address": "山东烟台",
      "registration_date": "1998-12-20",
      "type": "enterprise"
    }
  ],
  "total": 1,
  "query_type": "retrieve"
}
```

#### 1.6 批量属性检索
**用户需求**："所有化工企业的名称和地址列表"

**意图模板**：
```json
{
  "action": "retrieve",
  "targets": [{
    "type": "enterprise",
    "filters": {},
    "attributes": ["name", "address"]
  }]
}
```

**期望输出**：
```json
{
  "results": [
    {"id": "ent_001", "name": "万华化学", "address": "山东烟台", "type": "enterprise"},
    {"id": "ent_002", "name": "中石化", "address": "北京", "type": "enterprise"},
    {"id": "ent_003", "name": "巴斯夫", "address": "上海", "type": "enterprise"}
  ],
  "total": 156,
  "query_type": "retrieve"
}
```

### 二、关系扩展类（Expand）
> **场景特点**：从指定实体出发，沿着关系扩展查询相关实体
> **核心动作**：`action: "expand"`

#### 2.1 单跳关系扩展
**用户需求**："万华化学坐落在哪些园区？"

**意图模板**：
```json
{
  "action": "expand",
  "targets": [{
    "type": "enterprise",
    "filters": {
      "name": {"op": "match", "value": "万华化学"}
    }
  }],
  "relations": [{
    "type": "enterprise_2_park",
    "direction": "outgoing"
  }]
}
```

**期望输出**：
```json
{
  "query_type": "expand",
  "result": [
    {
      "nodes": [
        {"id": "ent_001", "name": "万华化学", "type": "enterprise"},
        {"id": "park_001", "name": "烟台化工园区", "type": "park"}
      ],
      "edges": [
        {"relation_type_id": "r_001", "relation_type_name":"关系类名称", "source_node": "ent_001", "target_node": "park_001"}
      ]
    },
    {
      "nodes": [
        {"id": "ent_001", "name": "万华化学", "type": "enterprise"},
        {"id": "park_002", "name": "宁波化工园区", "type": "park"}
      ],
      "edges": [
        {"relation_type_id": "r_001", "relation_type_name":"关系类名称", "source_node": "ent_001", "target_node": "park_002"}
      ]
    }
  ]
}
```

#### 2.2 多实体关系扩展
**用户需求**："万华化学和中石化拥有哪些专利？"

**意图模板**：
```json
{
  "action": "expand",
  "targets": [{
    "type": "enterprise",
    "filters": {
      "name": {"op": "in", "value": ["万华化学", "中石化"]}
    }
  }],
  "relations": [{
    "type": "enterprise_2_patent"
  }]
}
```

**期望输出**：
```json
{
  "query_type": "expand",
  "result": [
    {
      "nodes": [
        {"id": "ent_001", "name": "万华化学", "type": "enterprise"},
        {"id": "pat_001", "number": "CN123456", "title": "聚氨酯制备方法", "type": "patent"}
      ],
      "edges": [
        {"source": "ent_001", "target": "pat_001", "type": "enterprise_2_patent"}
      ]
    },
    {
      "nodes": [
        {"id": "ent_001", "name": "中石化", "type": "enterprise"},
        {"id": "pat_002", "number": "CN789012", "title": "催化剂组合物", "type": "patent"}
      ],
      "edges": [
        {"source": "ent_002", "target": "pat_002", "type": "enterprise_2_patent"}
      ]
    }
  ]
}
```

### 三、关系确认类（Confirm）
> **场景特点**：验证两个或多个实体之间是否存在特定关系
> **核心动作**：`action: "confirm"`

#### 3.1 双实体关系确认
**用户需求**："万华化学是否坐落在烟台化工园区？"

**意图模板**：
```json
{
  "action": "confirm",
  "targets": [
    {
      "type": "enterprise",
      "filters": {
        "name": {"op": "match", "value": "万华化学"}
      }
    },
    {
      "type": "park",
      "filters": {
        "name": {"op": "match", "value": "化工园区"},
        "address": {"op": "eq", "value": "烟台"}
      }
    }
  ],
  "relations": [{
    "type": "enterprise_2_park",
    "direction": "outgoing"
  }]
}
```

**期望输出**：
```json
{
  "query_type": "expand",
  "result": [
    {
      "nodes": [
        {"id": "ent_001", "name": "万华化学", "type": "enterprise"},
        {"id": "park_001", "name": "烟台化工园区", "type": "park"}
      ],
      "edges": [
        {"source": "ent_001", "target": "park_001", "type": "enterprise_2_park"}
      ]
    }
  ]
}
```

### 四、多类型并列查询类（Multi-Target）
> **场景特点**：同时查询多种不同类型的实体，各查询相互独立
> **核心动作**：`action: "retrieve"` + 多个targets

#### 4.1 多类型独立查询
**用户需求**："查询万华化学、中石化这两家企业，以及CAS号为64-17-5的物料信息"

**意图模板**：
```json
{
  "action": "retrieve",
  "targets": [
    {
      "type": "enterprise",
      "filters": {
        "name": {"op": "in", "value": ["万华化学", "中石化"]}
      }
    },
    {
      "type": "material",
      "filters": {
        "cas_no": {"op": "eq", "value": "64-17-5"}
      }
    }
  ]
}
```

**期望输出**：
```json
{
  "results": {
    "enterprise": [
      {"id": "ent_001", "name": "万华化学", "type": "enterprise"},
      {"id": "ent_002", "name": "中石化", "type": "enterprise"}
    ],
    "material": [
      {"id": "mat_001", "name": "乙醇", "cas_no": "64-17-5", "type": "material"}
    ]
  },
  "query_type": "multi_target"
}
```

### 六、混合模式场景类（Hybrid）
> **场景特点**：在自然语言中嵌入结构化限定，提升查询的可控性和精确性
> **核心动作**：`action: "hybrid"`

#### 6.1 嵌入式属性过滤

**用户需求**："查找万华化学在2021年后授权的、IPC包含C07D的专利"

**意图模板**：
```json
{
  "action": "hybrid",
  "targets": [
    {
      "type": "patent",
      "filters": {
        "enterprise_name": {"op": "eq", "value": "万华化学"},
        "grant_date": {"op": "gt", "value": "2021-01-01"},
        "ipc_class": {"op": "contains", "value": "C07D"},
        "status": {"op": "eq", "value": "授权"}
      }
    }
  ],
  "relations": [
    {"type": "enterprise_2_patent", "direction": "outgoing"}
  ]
}
```

**期望输出**：
```json
{
  "results": [
    {
      "id": "pat_001",
      "patent_no": "CN123456789A",
      "title": "一种C07D类化合物的合成方法",
      "grant_date": "2022-03-15",
      "ipc_class": "C07D213/02",
      "enterprise": "万华化学"
    }
  ],
  "query_type": "hybrid",
  "applied_constraints": ["time_range", "classification", "status_filter"]
}
```

#### 6.2 嵌入式关系类型过滤

**用户需求**："查找乙醇参与的氧化类反应产生的产物，限制返回前50个"

**意图模板**：
```json
{
  "action": "hybrid", 
  "targets": [
    {
      "type": "material",
      "filters": {
        "name": {"op": "match", "value": "乙醇"}
      }
    },
    {
      "type": "reaction",
      "filters": {
        "name": {"op": "match", "value": "氧化"}
      }
    }
  ],
  "relations": [
    {
      "type": "material_2_reaction",
      "direction": "outgoing",
      "filters": {
        "reaction_type": {"op": "contains", "value": "氧化"}
      }
    },
    {
      "type": "reaction_2_material", 
      "direction": "outgoing"
    }
  ],
  "depth": 2,
  "limit": 50
}
```

**期望输出**：
```json
{
  "results": [
    {
      "path": [
        {"id": "mat_001", "name": "乙醇", "type": "material"},
        {"id": "rxn_001", "name": "乙醇氧化反应", "type": "reaction", "reaction_type": "氧化还原"},
        {"id": "mat_002", "name": "乙醛", "type": "material"}
      ]
    }
  ],
  "query_type": "hybrid",
  "total_results": 50
}
```

#### 6.3 别名归一处理

**用户需求**："查询酒精的安全储存要求和相关工艺"

**意图模板**：
```json
{
  "action": "hybrid",
  "targets": [
    {
      "type": "material",
      "filters": {
        "name": {"op": "eq", "value": "酒精"},
        "aliases": {"op": "contains", "value": "乙醇"}
      },
      "attributes": ["name", "cas_no", "storage_requirements", "safety_notes"]
    }
  ],
  "relations": [
    {"type": "material_2_process", "direction": "outgoing"}
  ]
}
```

**期望输出**：
```json
{
  "results": {
    "material": {
      "id": "mat_001",
      "name": "乙醇",
      "aliases": ["酒精", "ethanol"],
      "cas_no": "64-17-5",
      "storage_requirements": "阴凉、通风、远离火源",
      "safety_notes": "易燃液体，避免静电"
    },
    "related_processes": [
      {"id": "proc_001", "name": "乙醇精馏工艺", "type": "process"}
    ]
  },
  "query_type": "hybrid",
  "alias_resolved": {"酒精": "乙醇"}
}
 ```

### 七、路径查询场景类（Path）【M2】
> **场景特点**：在多跳范围内查找从源到目的的路径，支持路径约束和最短路径计算
> **核心动作**：`action: "path"`

#### 7.1 多跳路径查询

**用户需求**："企业A生产的物料参与了哪些反应，并最终产出哪些物料？"

**意图模板**：
```json
{
  "action": "path",
  "source": {
    "type": "enterprise",
    "filters": {
      "name": {"op": "eq", "value": "企业A"}
    }
  },
  "target": {
    "type": "material",
    "filters": {}
  },
  "path_relations": [
    {"type": "enterprise_2_material", "direction": "outgoing"},
    {"type": "material_2_reaction", "direction": "outgoing"},
    {"type": "reaction_2_material", "direction": "outgoing"}
  ],
  "max_depth": 3,
  "path_type": "all_paths",
  "limit": 10
}
```

**期望输出**：
```json
{
  "paths": [
    {
      "path_id": "path_001",
      "length": 3,
      "nodes": [
        {"id": "ent_001", "name": "企业A", "type": "enterprise"},
        {"id": "mat_001", "name": "乙醇", "type": "material"},
        {"id": "rxn_001", "name": "乙醇氧化反应", "type": "reaction"},
        {"id": "mat_002", "name": "乙醛", "type": "material"}
      ],
      "edges": [
        {"type": "enterprise_2_material", "source": "ent_001", "target": "mat_001"},
        {"type": "material_2_reaction", "source": "mat_001", "target": "rxn_001"},
        {"type": "reaction_2_material", "source": "rxn_001", "target": "mat_002"}
      ]
    }
  ],
  "query_type": "path",
  "total_paths": 10
}
```

#### 7.2 最短路径查询

**用户需求**："从乙醇到乙酸的最短反应路径是什么？"

**意图模板**：
```json
{
  "action": "path",
  "source": {
    "type": "material",
    "filters": {
      "name": {"op": "eq", "value": "乙醇"}
    }
  },
  "target": {
    "type": "material", 
    "filters": {
      "name": {"op": "eq", "value": "乙酸"}
    }
  },
  "path_relations": [
    {"type": "material_2_reaction", "direction": "outgoing"},
    {"type": "reaction_2_material", "direction": "outgoing"}
  ],
  "max_depth": 6,
  "path_type": "shortest_path",
  "limit": 1
}
```

**期望输出**：
```json
{
  "paths": [
    {
      "path_id": "shortest_001",
      "length": 4,
      "nodes": [
        {"id": "mat_001", "name": "乙醇", "type": "material"},
        {"id": "rxn_001", "name": "乙醇氧化反应", "type": "reaction"},
        {"id": "mat_002", "name": "乙醛", "type": "material"},
        {"id": "rxn_002", "name": "乙醛氧化反应", "type": "reaction"},
        {"id": "mat_003", "name": "乙酸", "type": "material"}
      ],
      "total_cost": 2.5,
      "is_shortest": true
    }
  ],
  "query_type": "shortest_path"
}
```

#### 7.3 约束路径查询

**用户需求**："查找企业A到园区B的关联路径，要求经过专利关系"

**意图模板**：
```json
{
  "action": "path",
  "source": {
    "type": "enterprise",
    "filters": {
      "name": {"op": "eq", "value": "企业A"}
    }
  },
  "target": {
    "type": "park",
    "filters": {
      "name": {"op": "eq", "value": "园区B"}
    }
  },
  "path_constraints": {
    "required_relations": ["enterprise_2_patent"],
    "forbidden_relations": [],
    "required_node_types": ["patent"]
  },
  "max_depth": 4,
  "path_type": "constrained_paths"
}
```

**期望输出**：
```json
{
  "paths": [
    {
      "path_id": "constrained_001",
      "length": 3,
      "nodes": [
        {"id": "ent_001", "name": "企业A", "type": "enterprise"},
        {"id": "pat_001", "name": "专利P001", "type": "patent"},
        {"id": "ent_002", "name": "企业B", "type": "enterprise"},
        {"id": "park_001", "name": "园区B", "type": "park"}
      ],
      "satisfies_constraints": true
    }
  ],
  "query_type": "constrained_path",
  "constraints_applied": ["required_relations", "required_node_types"]
}
```

### 八、聚合与统计场景类（Aggregate）【M2】
> **场景特点**：基于对象与关系结果进行计数、分组与Top-K排序
> **核心动作**：`action: "aggregate"`

#### 8.1 Top-K排序统计

**用户需求**："拥有专利数量最多的企业排名前10"

**意图模板**：
```json
{
  "action": "aggregate",
  "targets": [
    {
      "type": "enterprise",
      "filters": {}
    }
  ],
  "relations": [
    {"type": "enterprise_2_patent", "direction": "outgoing"}
  ],
  "aggregation": {
    "group_by": "enterprise",
    "count_field": "patent",
    "sort_by": "count",
    "sort_order": "desc",
    "limit": 10
  }
}
```

**期望输出**：
```json
{
  "results": [
    {
      "enterprise": {"id": "ent_001", "name": "万华化学"},
      "patent_count": 1250,
      "rank": 1
    },
    {
      "enterprise": {"id": "ent_002", "name": "中石化"},
      "patent_count": 980,
      "rank": 2
    }
  ],
  "query_type": "top_k_aggregate",
  "total_enterprises": 500,
  "aggregation_field": "patent_count"
}
```

#### 8.2 分组统计

**用户需求**："各园区包含的企业数量统计"

**意图模板**：
```json
{
  "action": "aggregate",
  "targets": [
    {
      "type": "park",
      "filters": {}
    }
  ],
  "relations": [
    {"type": "enterprise_2_park", "direction": "incoming"}
  ],
  "aggregation": {
    "group_by": "park",
    "count_field": "enterprise",
    "include_zero": false
  }
}
```

**期望输出**：
```json
{
  "results": [
    {
      "park": {"id": "park_001", "name": "张江高科技园区"},
      "enterprise_count": 156
    },
    {
      "park": {"id": "park_002", "name": "苏州工业园区"},
      "enterprise_count": 89
    }
  ],
  "query_type": "group_aggregate",
  "total_parks": 25,
  "aggregation_summary": {
    "total_enterprises": 1200,
    "avg_enterprises_per_park": 48
  }
}
```

#### 8.3 多维度聚合

**用户需求**："按IPC分类统计各企业的专利分布"

**意图模板**：
```json
{
  "action": "aggregate",
  "targets": [
    {
      "type": "patent",
      "filters": {}
    }
  ],
  "relations": [
    {"type": "enterprise_2_patent", "direction": "incoming"}
  ],
  "aggregation": {
    "group_by": ["enterprise", "ipc_class"],
    "count_field": "patent",
    "sort_by": "count",
    "sort_order": "desc",
    "limit": 50
  }
}
```

**期望输出**：
```json
{
  "results": [
    {
      "enterprise": {"id": "ent_001", "name": "万华化学"},
      "ipc_class": "C07D",
      "patent_count": 245
    },
    {
      "enterprise": {"id": "ent_001", "name": "万华化学"},
      "ipc_class": "C08G",
      "patent_count": 189
    }
  ],
  "query_type": "multi_dimension_aggregate",
  "dimensions": ["enterprise", "ipc_class"]
}
 ```

### 九、集合运算与比对场景类（Set/Compare）【M2】
> **场景特点**：基于对象邻居集合进行交集、并集、差集运算和相似度比对
> **核心动作**：`action: "set_operation"` 或 `action: "compare"`

#### 9.1 交集运算

**用户需求**："企业A和企业B共同拥有的专利有哪些？"

**意图模板**：
```json
{
  "action": "set_operation",
  "operation": "intersection",
  "sets": [
    {
      "source": {
        "type": "enterprise",
        "filters": {
          "name": {"op": "eq", "value": "企业A"}
        }
      },
      "relation": {"type": "enterprise_2_patent", "direction": "outgoing"},
      "target_type": "patent"
    },
    {
      "source": {
        "type": "enterprise", 
        "filters": {
          "name": {"op": "eq", "value": "企业B"}
        }
      },
      "relation": {"type": "enterprise_2_patent", "direction": "outgoing"},
      "target_type": "patent"
    }
  ],
  "return_details": true
}
```

**期望输出**：
```json
{
  "operation": "intersection",
  "result": [
    {
      "id": "pat_001",
      "name": "聚氨酯合成工艺专利",
      "ipc_class": "C08G18/00",
      "shared_by": ["企业A", "企业B"]
    },
    {
      "id": "pat_002", 
      "name": "催化剂制备方法",
      "ipc_class": "B01J23/00",
      "shared_by": ["企业A", "企业B"]
    }
  ],
  "query_type": "set_intersection",
  "result_count": 2,
  "set_sizes": {
    "企业A": 150,
    "企业B": 89,
    "intersection": 2
  }
}
```

#### 9.2 差集运算

**用户需求**："企业A拥有但企业B没有的专利有哪些？"

**意图模板**：
```json
{
  "action": "set_operation",
  "operation": "difference",
  "sets": [
    {
      "source": {
        "type": "enterprise",
        "filters": {
          "name": {"op": "eq", "value": "企业A"}
        }
      },
      "relation": {"type": "enterprise_2_patent", "direction": "outgoing"},
      "target_type": "patent"
    },
    {
      "source": {
        "type": "enterprise",
        "filters": {
          "name": {"op": "eq", "value": "企业B"}
        }
      },
      "relation": {"type": "enterprise_2_patent", "direction": "outgoing"},
      "target_type": "patent"
    }
  ],
  "limit": 20
}
```

**期望输出**：
```json
{
  "operation": "difference",
  "result": [
    {
      "id": "pat_003",
      "name": "新型聚合物材料",
      "ipc_class": "C08L75/00",
      "unique_to": "企业A"
    }
  ],
  "query_type": "set_difference",
  "result_count": 148,
  "returned_count": 20
}
```

#### 9.3 相似度比对

**用户需求**："找出与企业A专利组合最相似的前5家企业"

**意图模板**：
```json
{
  "action": "compare",
  "comparison_type": "similarity",
  "reference": {
    "source": {
      "type": "enterprise",
      "filters": {
        "name": {"op": "eq", "value": "企业A"}
      }
    },
    "relation": {"type": "enterprise_2_patent", "direction": "outgoing"},
    "target_type": "patent"
  },
  "candidates": {
    "source": {
      "type": "enterprise",
      "filters": {
        "name": {"op": "ne", "value": "企业A"}
      }
    },
    "relation": {"type": "enterprise_2_patent", "direction": "outgoing"},
    "target_type": "patent"
  },
  "similarity_metric": "jaccard",
  "limit": 5
}
```

**期望输出**：
```json
{
  "comparison_type": "similarity",
  "reference": {"id": "ent_001", "name": "企业A"},
  "results": [
    {
      "candidate": {"id": "ent_005", "name": "万华化学"},
      "similarity_score": 0.75,
      "common_patents": 45,
      "total_patents_candidate": 89,
      "jaccard_index": 0.75,
      "rank": 1
    },
    {
      "candidate": {"id": "ent_012", "name": "巴斯夫"},
      "similarity_score": 0.68,
      "common_patents": 38,
      "total_patents_candidate": 156,
      "jaccard_index": 0.68,
      "rank": 2
    }
  ],
  "query_type": "similarity_ranking",
  "metric_used": "jaccard"
}
```

#### 9.4 多对象集合比对

**用户需求**："比较园区A、园区B、园区C中企业的重叠情况"

**意图模板**：
```json
{
  "action": "set_operation",
  "operation": "multi_set_analysis",
  "sets": [
    {
      "name": "园区A",
      "source": {
        "type": "park",
        "filters": {
          "name": {"op": "eq", "value": "园区A"}
        }
      },
      "relation": {"type": "enterprise_2_park", "direction": "incoming"},
      "target_type": "enterprise"
    },
    {
      "name": "园区B",
      "source": {
        "type": "park",
        "filters": {
          "name": {"op": "eq", "value": "园区B"}
        }
      },
      "relation": {"type": "enterprise_2_park", "direction": "incoming"},
      "target_type": "enterprise"
    },
    {
      "name": "园区C",
      "source": {
        "type": "park",
        "filters": {
          "name": {"op": "eq", "value": "园区C"}
        }
      },
      "relation": {"type": "enterprise_2_park", "direction": "incoming"},
      "target_type": "enterprise"
    }
  ],
  "analysis_type": "venn_diagram"
}
```

**期望输出**：
```json
{
  "operation": "multi_set_analysis",
  "venn_analysis": {
    "园区A_only": 45,
    "园区B_only": 32,
    "园区C_only": 28,
    "园区A_园区B": 8,
    "园区A_园区C": 5,
    "园区B_园区C": 12,
    "all_three": 3
  },
  "set_sizes": {
    "园区A": 61,
    "园区B": 55,
    "园区C": 48
  },
  "total_unique_enterprises": 133,
  "overlap_summary": {
    "any_overlap": 28,
    "no_overlap": 105
  }
}
```

#### 9.5 集合相似度Top-K

**用户需求**："找出反应物料组合与目标反应最相似的前10个反应"

**意图模板**：
```json
{
  "action": "compare",
  "comparison_type": "set_similarity_topk",
  "reference": {
    "source": {
      "type": "reaction",
      "filters": {
        "name": {"op": "eq", "value": "目标反应"}
      }
    },
    "relation": {"type": "material_2_reaction", "direction": "incoming"},
    "target_type": "material"
  },
  "candidates": {
    "source": {
      "type": "reaction",
      "filters": {
        "name": {"op": "ne", "value": "目标反应"}
      }
    },
    "relation": {"type": "material_2_reaction", "direction": "incoming"},
    "target_type": "material"
  },
  "similarity_metric": "cosine",
  "min_similarity": 0.3,
  "limit": 10
}
```

**期望输出**：
```json
{
  "comparison_type": "set_similarity_topk",
  "reference": {"id": "rxn_001", "name": "目标反应"},
  "results": [
    {
      "candidate": {"id": "rxn_045", "name": "乙醇氧化反应"},
      "similarity_score": 0.89,
      "common_materials": ["乙醇", "氧气"],
      "cosine_similarity": 0.89,
      "rank": 1
    }
  ],
  "query_type": "set_similarity_topk",
  "total_candidates": 500,
  "qualified_candidates": 45
}
```

## 操作符与字段说明

### 常用过滤操作符
- `eq`：等于
- `ne`：不等于  
- `contains`：包含
- `not_contains`：不包含
- `starts_with`：以...开头
- `ends_with`：以...结尾
- `lt`：小于
- `le`：小于等于
- `gt`：大于
- `ge`：大于等于
- `in`：在列表中
- `not_in`：不在列表中

### 关系方向
- `outgoing`：正向关系（从source到target）
- `incoming`：反向关系（从target到source）
- `both`：双向关系

### 核心字段说明
- `action`：查询动作类型（retrieve/expand/confirm）
- `targets`：查询目标实体类型和过滤条件
  - `type`：实体类型
  - `filters`：过滤条件
  - `attributes`：指定返回的属性字段（可选，默认返回所有属性）
- `relations`：关系类型和方向（仅用于expand和confirm）
- `depth`：查询深度（仅用于expand）
- `limit`：结果数量限制（可选）

## 模板设计原则与最佳实践

### 设计原则
1. **统一性**：所有查询都使用相同的基础结构
2. **扩展性**：通过`targets`数组支持多类型查询
3. **简洁性**：避免过度嵌套，保持结构扁平
4. **语义清晰**：`action`字段明确表达查询意图
5. **灵活性**：支持复杂的过滤条件和关系组合

### 意图识别边界原则
- **只识别用户query中明确表达的内容**
- **不推测用户未明确表达的需求**
- 对于排序、分页、限制数量等，只有在用户明确提及时才填充
- 未明确表达的字段应该为空或使用默认值

### 与现有方案的对比

#### 优势
- **可读性强**：字段名直观，无需查表
- **学习成本低**：统一结构，容易掌握
- **维护简单**：无需复杂的编解码逻辑
- **调试友好**：JSON结构清晰，便于排查问题

### Token优化建议
如果需要减少token输出，可以考虑：
1. 缩短字段名：`action` → `act`，`targets` → `tgt`
2. 使用枚举代号：`retrieve` → `R`，`expand` → `E`
3. 但保持基本的可读性，避免过度缩写