# 阶段1用户提示词模板 (生产版本)

## 模板结构

```
背景信息：
对象类：{object_classes}
关系类：{relation_classes}

问题：{query}
```

## 使用说明

### 1. 占位符说明
- `{object_classes}`: 动态注入的对象类信息
- `{relation_classes}`: 动态注入的关系类信息  
- `{query}`: 用户的实际问题

### 2. 背景信息格式

#### 对象类格式示例：
```
员工(属性：姓名、工号、部门、职位)、部门(属性：部门名、负责人、预算)、项目(属性：项目名、状态、负责人)
```

#### 关系类格式示例：
```
员工-隶属于-部门、员工-参与-项目、部门-管理-项目
```

### 3. 完整调用示例

**输入：**
```
背景信息：
对象类：员工(属性：姓名、工号、部门、职位)、部门(属性：部门名、负责人、预算)、项目(属性：项目名、状态、负责人)
关系类：员工-隶属于-部门、员工-参与-项目、部门-管理-项目

问题：张三在哪个部门工作？
```

**输出：**
```
E
```

## 实现要点

### 1. 背景信息动态生成
- 根据问题内容智能选择相关的对象类和关系类
- 控制背景信息长度，避免超出模型上下文限制
- 优先包含与问题最相关的类型信息

### 2. 模板参数化
```python
# 示例代码
user_prompt = f"""背景信息：
对象类：{format_object_classes(relevant_objects)}
关系类：{format_relation_classes(relevant_relations)}

问题：{user_query}"""
```

### 3. 错误处理
- 当背景信息为空时，使用简化模板：`问题：{query}`
- 当背景信息过长时，进行智能截断
- 保证模板格式的一致性

## 性能优化建议

### 1. 背景信息缓存
- 对常用的对象类和关系类组合进行缓存
- 减少重复的格式化操作

### 2. 模板预编译
- 使用模板引擎预编译用户提示词模板
- 提高运行时的渲染效率

### 3. 长度控制
- 设置背景信息的最大长度限制
- 优先保留与问题最相关的信息